{% extends "index.html" %}
{% block title %}Furniture Store{% endblock title %}

{% block content %}
<section class="categories" id="categories">
    <h1>Furniture Categories</h1>
    <form method="get">
        <ul class="category-list">
            <li><button class="category-btn" value="bed" name="category">Beds</button></li>
            <li><button class="category-btn" value="sofa" name="category">Sofas</button></li>
            <li><button class="category-btn" value="chair" name="category">Chairs</button></li>
            <li><button class="category-btn" value="table" name="category">Tables</button></li>
            <li><button class="category-btn" value="dresser" name="category">Dressers</button></li>
            <li><button class="category-btn" value="wardrobe" name="category">Wardrobes</button></li>
            <li><button class="category-btn" value="bookshelf" name="category">Bookshelves</button></li>
            <li><button class="category-btn" value="desk" name="category">Desks</button></li>
            <li><button class="category-btn" value="cabinet" name="category">Cabinets</button></li>
            <li><button class="category-btn" value="nightstand" name="category">Nightstands</button></li>
            <li><button class="category-btn" value="dining_set" name="category">Dining Sets</button></li>
            <li><button class="category-btn" value="coffee_table" name="category">Coffee Tables</button></li>
            <li><button class="category-btn" value="tv_stand" name="category">TV Stands</button></li>
            <li><button class="category-btn" value="ottoman" name="category">Ottomans</button></li>
            <li><button class="category-btn" value="recliner" name="category">Recliners</button></li>
            <li><button class="category-btn" value="shelving_unit" name="category">Shelving Units</button></li>
            <li><button class="category-btn" value="bench" name="category">Benches</button></li>
            <li><button class="category-btn" value="bar_stool" name="category">Bar Stools</button></li>
            <li><button class="category-btn" value="mattress" name="category">Mattresses</button></li>
            <li><button class="category-btn" value="outdoor_furniture" name="category">Outdoor Furniture</button></li>
        </ul>
    </form>
</section> 

<section class="products" id="products">
    <h2>
        {% if selected_category %}
            Showing {{ selected_category }}s
        {% else %}
            All Products
        {% endif %}
    </h2>
    
    <!-- Professional filter and sort section -->
    <div class="filter-sort-container">
        <form method="get" class="filter-form">
            {% if category %}
                <input type="hidden" name="category" value="{{ category }}">
            {% endif %}
            <div class="sort-group">
                <label for="sort_by">Sort by:</label>
                <select name="sort_by" id="sort_by" onchange="this.form.submit()">
                    <option value="" {% if not sort_by %}selected{% endif %}>Relevance</option>
                    <option value="price_low" {% if sort_by == 'price_low' %}selected{% endif %}>Price: Low to High</option>
                    <option value="price_high" {% if sort_by == 'price_high' %}selected{% endif %}>Price: High to Low</option>
                    <option value="new" {% if sort_by == 'new' %}selected{% endif %}>Newest First</option>
                    <option value="discount" {% if sort_by == 'discount' %}selected{% endif %}>Discount: High to Low</option>
                </select>
            </div>
            <div class="filter-group">
                <input type="checkbox" name="discounted" id="discounted" {% if show_discounted %}checked{% endif %} onchange="this.form.submit()">
                <label for="discounted">Show only discounted items</label>
            </div>
        </form>
    </div>
    
    <div class="product-grid">
        {% for product in products %}
            <div class="product-card">
                <h3>{{ product.title }}</h3>
                <a href="{% url 'details' product.pk %}">
                    <img src="{{ product.img.url }}" alt="{{ product.title }}" width="200">
                </a>
                <p class="price">₹{{ product.price }}{% if product.discount_price %} <span class="discount">₹{{ product.discount_price }} (Discounted)</span>{% endif %}</p>
                <p><strong>Type:</strong> {{ product.get_type_display }}</p>
                {% comment %} <p><strong>Material:</strong> {{ product.material }}</p>
                <p><strong>Color:</strong> {{ product.color }}</p>
                <p><strong>Dimensions:</strong> {{ product.dimensions }}</p>
                <!-- Removed weight, sku, slug as they are not in the model; add fields to model if needed -->
                <p><strong>Brand:</strong> {{ product.brand }}</p>
                <p>{{ product.description }}</p>
                <p class="date">Added on: {{ product.date|date:"M d, Y" }}</p>
                <p><strong>Stock:</strong> {{ product.stock }}</p> {% endcomment %}
                
                {% if user.is_authenticated and user.is_superuser %}
                    <!-- Admin controls (fixed the misplaced form tags) -->
                    <form method="post" action="{% url 'delete_furniture' product.pk %}">
                        {% csrf_token %}
                        <div class="actions">
                            <a href="{% url 'edit_furniture' product.pk %}" class="btn-edit">Edit</a>
                            <button type="submit" class="btn-delete">Delete</button>
                        </div>
                    </form>
                {% endif %}
            </div>
        {% empty %}
            <p>No products found.</p>
        {% endfor %}
    </div>
</section>

{% endblock %}